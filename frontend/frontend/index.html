<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAI Studio - Professional Editor</title>

    <!-- 1. External Libraries -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">

    <!-- 2. Tailwind Config -->
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: { dark: '#09090b', panel: '#18181b', hover: '#27272a', input: '#202023' },
                        ui: { border: '#27272a', selected: '#3f3f46', accent: '#3b82f6', danger: '#ef4444', success: '#22c55e' },
                        text: { main: '#f4f4f5', sub: '#a1a1aa', inv: '#18181b' }
                    },
                    fontSize: { 'xxs': '10px' },
                    spacing: { '15px': '15px' }
                }
            }
        }
    </script>

    <!-- 3. Custom CSS -->
    <link rel="stylesheet" href="css/main.css">
</head>

<body id="app-root-container" class="flex flex-col text-xs">
    <div id="app-vue-root" class="flex flex-col h-screen">

        <!-- Header -->
        <header id="header-main-panel" class="h-12 bg-bg-panel border-b border-ui-border flex items-center justify-between shrink-0 select-none px-[15px]">
            <div class="flex items-center h-full gap-2">
                <div id="header-main-logo-label" class="font-bold text-lg tracking-tighter text-text-main mr-2" title="WAI Studio 홈">WAI</div>

                <div id="header-main-menu-container" class="relative group h-full flex items-center mr-2">
                    <button class="text-lg text-text-sub hover:text-text-main" title="메인 메뉴 (준비 중)"><i class="fa-solid fa-bars"></i></button>
                </div>

                <!-- 메인메뉴 - 간격 60% 축소 (gap-[15px] → gap-[6px]) -->
                <nav id="header-nav-container" class="flex items-center gap-[6px] h-full">
                    <button id="header-nav-explore-btn" class="nav-btn" @click="firePython('nav_explore')" data-action="py:nav_explore" title="프로젝트 탐색 열기">탐색</button>
                    
                    <div id="header-nav-create-wrapper" class="header-menu-wrapper h-full" :class="{ 'open': headerMenus.create }">
                        <button id="header-nav-create-btn" class="nav-btn" :class="{ 'active': headerMenus.create }" @click="toggleHeaderMenu('create')" data-action="js:toggleCreateMenu" title="제작 메뉴">제작</button>
                        <div class="header-menu-dropdown">
                            <div id="header-menu-create-project" class="header-menu-item" @click="openProjectManager" data-action="js:openProjectManager"><span>프로젝트 관리</span></div>
                        </div>
                    </div>
                    
                    <div id="header-nav-assets-wrapper" class="header-menu-wrapper h-full" :class="{ 'open': headerMenus.assets }">
                        <button id="header-nav-assets-btn" class="nav-btn" :class="{ 'active': headerMenus.assets }" @click="toggleHeaderMenu('assets')" data-action="js:toggleAssetsMenu" title="자산 메뉴">자산</button>
                        <div class="header-menu-dropdown">
                            <div id="header-menu-assets-manage-wrapper" class="header-submenu-wrapper" :class="{ 'open': headerSubmenus.assetManage }">
                                <div id="header-menu-assets-manage" class="header-menu-item" @click="toggleHeaderSubmenu('assetManage')" data-action="js:toggleAssetManageSubmenu">
                                    <span>자산 관리</span>
                                    <i class="fa-solid fa-chevron-right text-[10px]"></i>
                                </div>
                                <div class="header-submenu">
                                    <div id="header-submenu-asset-video" class="header-submenu-item" @click="openAssetManager('video')" data-action="js:openAssetManagerVideo">영상</div>
                                    <div id="header-submenu-asset-image" class="header-submenu-item" @click="openImageAssetModal" data-action="js:openImageAssetModal">이미지</div>
                                    <div id="header-submenu-asset-sound" class="header-submenu-item" @click="openAssetManager('sound')" data-action="js:openAssetManagerSound">사운드</div>
                                    <div id="header-submenu-asset-effect" class="header-submenu-item" @click="openImageEffectModal" data-action="js:openImageEffectModal">이미지효과</div>
                                </div>
                            </div>
                            <div id="header-menu-assets-visualization" class="header-menu-item" @click="openVisualizationModal" data-action="js:openVisualizationModal"><span>시각화</span></div>
                        </div>
                    </div>
                    
                    <button id="header-nav-operation-btn" class="nav-btn" @click="firePython('nav_operation')" data-action="py:nav_operation" title="운영 패널 열기">운영</button>
                    <button id="header-nav-research-btn" class="nav-btn" @click="firePython('nav_research')" data-action="py:nav_research" title="연구 패널 열기">연구</button>
                    
                    <div id="header-nav-settings-wrapper" class="header-menu-wrapper h-full" :class="{ 'open': headerMenus.settings }">
                        <button id="header-nav-settings-btn" class="nav-btn" :class="{ 'active': headerMenus.settings }" @click="toggleHeaderMenu('settings')" data-action="js:toggleSettingsMenu" title="설정 메뉴">설정</button>
                        <div class="header-menu-dropdown">
                            <div id="header-menu-settings-api" class="header-menu-item" @click="openApiManagerModal" data-action="js:openApiManagerModal"><span>API 관리</span></div>
                            <div id="header-menu-settings-account" class="header-menu-item" @click="openAccountManager" data-action="js:openAccountManager"><span>계정관리</span></div>
                            <div id="header-menu-settings-logout" class="header-menu-item" @click="handleLogout" data-action="js:handleLogout"><span>로그아웃</span></div>
                        </div>
                    </div>
                </nav>
            </div>

            <div class="flex items-center h-full gap-0">
                <button id="header-dev-inspect-btn" class="h-6 px-3 border border-ui-border rounded-l text-text-sub hover:text-white hover:bg-bg-hover flex items-center gap-1 transition-colors" :class="{'bg-ui-selected text-text-main': isDevModeActive}" @click="toggleDevMode('active')" data-action="js:toggleDevModeActive" title="Inspect 모드 토글"><i class="fa-solid fa-magnifying-glass"></i> Inspect</button>
                <button id="header-dev-mode-btn" class="h-6 px-3 border border-ui-border border-l-0 rounded-r text-text-sub hover:text-white hover:bg-bg-hover flex items-center gap-1 mr-4 transition-colors" :class="{'bg-ui-selected text-text-main': isDevModeFull}" @click="toggleDevMode('full')" data-action="js:toggleDevModeFull" title="개발자 모드 토글"><i class="fa-solid fa-code"></i> Dev</button>

                <div id="header-window-controls-container" class="flex items-center h-full ml-4 border-l border-ui-border">
                    <button id="header-window-min-btn" class="win-btn" @click="firePython('win_min')" data-action="py:win_min" title="창 최소화"><i class="fa-solid fa-window-minimize"></i></button>
                    <button id="header-window-max-btn" class="win-btn" @click="firePython('win_max')" data-action="py:win_max" title="창 최대화/복원"><i class="fa-regular fa-square"></i></button>
                    <button id="header-window-close-btn" class="win-btn close" @click="firePython('win_close')" data-action="py:win_close" title="앱 종료"><i class="fa-solid fa-xmark"></i></button>
                </div>
            </div>
        </header>

        <!-- Main Layout -->
        <main id="main-layout-root" class="flex-1 flex overflow-hidden relative">
            <!-- Left Panel -->
            <aside id="main-left-panel" class="bg-bg-panel flex flex-col relative border-r border-ui-border" :style="{ width: leftPanelWidth + 'px', minWidth: '180px' }">
                <div class="flex-1 flex items-center justify-center text-text-sub opacity-30">
                    <div class="text-center">
                        <i class="fa-solid fa-layer-group text-2xl mb-2"></i>
                        <div class="text-[10px]">좌측 패널</div>
                    </div>
                </div>
                <div id="main-left-resizer-v" class="panel-resizer-v right-0" title="좌측 패널 너비 조절" data-action="js:resizePanelLeft"></div>
            </aside>

            <!-- Center Panel -->
            <section id="main-center-panel" class="flex-1 flex flex-col bg-bg-dark min-w-[400px] relative overflow-hidden">
                <div id="preview-main-container" class="relative flex flex-col" :style="{ height: previewContainerHeight }">
                    <div id="preview-toolbar-panel" class="h-8 bg-bg-panel border-b border-ui-border flex items-center justify-center px-2 gap-3 shrink-0 z-20">
                        <div class="flex items-center gap-2 bg-bg-input rounded px-3 h-6 border border-ui-border">
                            <dropdown-menu id="preview-toolbar-ratio-dropdown" label="화면비율" :current-value="aspectRatio" :items="['16:9', '9:16', '1:1']" @select="setAspect" title="캔버스 화면비율 (메타데이터)"></dropdown-menu>
                            <div class="w-px h-3 bg-ui-border"></div>
                            <dropdown-menu id="preview-toolbar-resolution-dropdown" label="해상도" :current-value="currentResolutionLabel" :items="resolutionOptions" @select="setResolution" title="캔버스 해상도 선택 (메타데이터)"></dropdown-menu>
                            <div class="w-px h-3 bg-ui-border"></div>
                            <div id="preview-zoom-indicator" class="flex items-center pl-2 text-xxs text-text-sub" title="프리뷰 화면 배율 (표시용)">화면 배율&nbsp;<span id="preview-zoom-indicator-value">100%</span></div>
                        </div>
                    </div>
                    <div id="preview-canvas-wrapper" class="flex-1 relative overflow-hidden bg-black flex items-center justify-center" @mouseleave="mouseCoord = {x: 0, y: 0}; isMouseOverCanvas = false">
                        <div id="preview-canvas-viewport">
                            <div id="preview-canvas-scaler" :class="['canvas-scaler', 'canvas-ar-' + (aspectRatio || '16:9').replace(':','-')]" :style="canvasScalerStyle">
                                <canvas id="preview-render-canvas"></canvas>
                                <preview-canvas :canvas-boxes="canvasBoxes" :canvas-size="canvasSize" :selected-box-<span class="cursor">█</span>
