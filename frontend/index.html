<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>WAI Studio - Professional Editor (Full Version)</title>
    
    <!-- Vue 3 -->
    <script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
    
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    
    <!-- SweetAlert2 -->
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- interact.js -->
    <script src="https://cdn.jsdelivr.net/npm/interactjs/dist/interact.min.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        bg: { 
                            dark: '#09090b',
                            panel: '#18181b',
                            hover: '#27272a',
                            input: '#202023'
                        },
                        ui: { 
                            border: '#27272a',
                            selected: '#3f3f46',
                            accent: '#3b82f6',
                            danger: '#ef4444',
                            success: '#22c55e'
                        },
                        text: { 
                            main: '#f4f4f5',
                            sub: '#a1a1aa',
                            inv: '#18181b'
                        }
                    },
                    fontSize: { 
                        'xxs': '10px' 
                    },
                    spacing: { 
                        '15px': '15px' 
                    },
                    cursor: { 
                        'ew-resize': 'ew-resize', 
                        'ns-resize': 'ns-resize',
                        'row-resize': 'row-resize',
                        'col-resize': 'col-resize'
                    }
                }
            }
        }
    </script>

    <style>
        /* 전역 설정 */
        body { 
            background-color: #09090b; 
            color: #f4f4f5; 
            height: 100vh; 
            overflow: hidden; 
            user-select: none; 
            font-family: 'Pretendard', -apple-system, BlinkMacSystemFont, system-ui, Roboto, sans-serif; 
        }
        
        /* 스크롤바 */
        ::-webkit-scrollbar { width: 6px; height: 6px; }
        ::-webkit-scrollbar-track { background: #18181b; }
        ::-webkit-scrollbar-thumb { background: #3f3f46; border-radius: 3px; }
        ::-webkit-scrollbar-thumb:hover { background: #52525b; }

        /* 타임라인 그리드 */
        .timeline-grid { 
            display: grid; 
            height: 100%; 
            overflow: hidden;
        }
        
        .sticky-corner { position: sticky; top: 0; left: 0; z-index: 50; background: #18181b; border-bottom: 1px solid #27272a; border-right: 1px solid #27272a; }
        .sticky-ruler  { position: sticky; top: 0; z-index: 40; background: #09090b; border-bottom: 1px solid #27272a; }
        .sticky-col    { position: sticky; left: 0; z-index: 30; background: #18181b; border-right: 1px solid #27272a; }

        /* 클립 */
        .clip { 
            position: absolute; 
            top: 4px; 
            height: 32px; 
            border-radius: 4px; 
            overflow: hidden; 
            border: 1px solid rgba(255,255,255,0.1); 
            cursor: pointer; 
            transition: box-shadow 0.1s, border-color 0.1s; 
            touch-action: none;
        }
        .clip:hover { 
            filter: brightness(1.1); 
            z-index: 10; 
            border-color: rgba(255,255,255,0.5); 
        }
        .clip.selected { 
            border: 2px solid #fff; 
            z-index: 20; 
            box-shadow: 0 0 10px rgba(59, 130, 246, 0.3); 
        }
        .clip.dragging { 
            opacity: 0.8; 
            z-index: 100 !important; 
            cursor: grabbing; 
            box-shadow: 0 5px 15px rgba(0,0,0,0.5); 
        }
        .clip-label { 
            pointer-events: none; 
            text-shadow: 0 1px 2px black; 
            font-size: 10px;
            padding: 2px 6px;
            font-weight: bold;
            color: white;
            position: relative;
            z-index: 2;
        }

        /* 오디오 파형/볼륨 라인 */
        .waveform { 
            position: absolute; top: 50%; left: 0; width: 100%; height: 100%; 
            transform: translateY(-50%); opacity: 0.6; pointer-events: none; 
        }
        .volume-line { 
            position: absolute; top: 30%; left: 0; width: 100%; height: 2px; 
            background: rgba(255,255,255,0.8); cursor: ns-resize; z-index: 5; 
            box-shadow: 0 1px 2px rgba(0,0,0,0.5); 
        }
        .volume-line:hover { background: #3b82f6; height: 3px; }

        /* 프리뷰 캔버스 박스 */
        .canvas-scaler { 
            transform-origin: top left; 
            background-color: #000; 
            box-shadow: 0 0 50px rgba(0,0,0,0.5); 
            position: relative; 
        }
        .canvas-box { 
            position: absolute; 
            border: 2px dashed rgba(255,255,255,0.3); 
            background: rgba(255,255,255,0.05);
            display: flex; align-items: flex-start; justify-content: flex-end; 
            touch-action: none; box-sizing: border-box; 
        }
        .canvas-box.selected { 
            border-style: solid; 
            box-shadow: 0 0 0 1px #fff, 0 0 10px rgba(0,0,0,0.5); 
            z-index: 1000 !important; 
            border-color: #3b82f6;
        }
        .canvas-label { 
            position: absolute; right: 0; bottom: -16px; 
            background: #3b82f6; color: #fff; 
            padding: 0 4px; font-size: 9px; font-weight: bold; 
            border-radius: 2px; font-family: monospace; 
            white-space: nowrap; pointer-events: none; 
            text-shadow: 0 1px 2px black; opacity: 0.8; 
        }
        
        /* 박스 핸들 */
        .box-handle { 
            position: absolute; width: 8px; height: 8px; 
            background: #fff; border: 1px solid #000; 
            z-index: 20; display: none; 
        }
        .canvas-box.selected .box-handle { display: block; }
        .bh-tl { top: -4px; left: -4px; cursor: nwse-resize; }
        .bh-tr { top: -4px; right: -4px; cursor: nesw-resize; }
        .bh-bl { bottom: -4px; left: -4px; cursor: nesw-resize; }
        .bh-br { bottom: -4px; right: -4px; cursor: nwse-resize; }
        
        /* 스냅 플래시 */
        @keyframes flash { 
            0% { background-color: rgba(255,255,255,0.8); } 
            100% { background-color: rgba(255,255,255,0.05); } 
        }
        .snap-flash { animation: flash 0.3s ease-out; border-color: #fff !important; }

        /* 가이드 */
        .guide-line-h { 
            position: absolute; left: 0; right: 0; height: 1px; 
            background-color: #3b82f6; border-top: 1px dashed #3b82f6; 
            display: none; pointer-events: none; z-index: 9999; opacity: 0.8; 
        }
        .guide-line-v { 
            position: absolute; top: 0; bottom: 0; width: 1px; 
            background-color: #3b82f6; border-left: 1px dashed #3b82f6; 
            display: none; pointer-events: none; z-index: 9999; opacity: 0.8; 
        }

        /* 패널 리사이저 */
        .panel-resizer-v { 
            position: absolute; top: 0; bottom: 0; width: 4px; 
            cursor: col-resize; z-index: 100; transition: background 0.2s; 
        }
        .panel-resizer-v:hover { background: #3b82f6; }
        
        .panel-resizer-h { 
            width: 100%; height: 4px; background: #18181b; 
            cursor: row-resize; z-index: 100; transition: background 0.2s; 
            border-top: 1px solid #27272a; border-bottom: 1px solid #27272a; 
        }
        .panel-resizer-h:hover { background: #3b82f6; }

        /* 트랙 리사이저 */
        .resizer-w { 
            position: absolute; top: 0; right: 0; width: 5px; height: 100%; 
            cursor: col-resize; z-index: 60; 
        }
        .resizer-h { 
            position: absolute; bottom: 0; left: 0; width: 100%; height: 5px; 
            cursor: row-resize; z-index: 60; 
        }
        .resizer-h:hover, .resizer-w:hover { background-color: #3b82f6; }

        /* 공통 버튼 */
        .tool-btn { 
            @apply p-1 rounded text-text-sub hover:text-text-main hover:bg-bg-hover transition-colors text-xs flex items-center justify-center w-6 h-6; 
        }
        .tool-btn.active { @apply text-ui-accent bg-bg-hover; }
        
        .nav-btn { 
            @apply px-3 py-1 text-xs text-text-sub hover:text-text-main hover:bg-ui-selected rounded transition-colors cursor-pointer h-full flex items-center; 
        }
        .nav-btn.active { @apply text-text-main font-bold bg-bg-hover; }
        
        .win-btn { 
            @apply w-10 h-full flex items-center justify-center text-text-sub hover:bg-bg-hover hover:text-text-main transition-colors text-xs; 
        }
        .win-btn.close:hover { @apply bg-ui-danger text-white; }

        /* 커스텀 드롭다운 */
        .c-dropdown { 
            @apply relative inline-flex items-center px-2 h-full bg-bg-input rounded text-[10px] text-text-sub cursor-pointer hover:bg-bg-hover hover:text-text-main border border-ui-border select-none; 
        }
        .c-dropdown-menu { 
            display: none;
            position: absolute;
            top: 100%;         /* 버튼 바로 아래 */
            left: 0;
            margin-top: 2px;   /* 살짝 간격 */
            width: 100%; 
            background-color: #18181b; border: 1px solid #27272a; border-radius: 4px; 
            flex-direction: column; z-index: 2000; box-shadow: 0 4px 12px rgba(0,0,0,0.5);
        }
        .c-dropdown.open .c-dropdown-menu { display: flex; }
        
        .c-dropdown-item { @apply p-2 text-center hover:bg-ui-accent hover:text-white transition-colors; }
        .c-dropdown.locked { cursor: not-allowed; opacity: 0.7; border-color: #333; background: #1a1a1a; }
        .c-dropdown.locked:hover { background: #1a1a1a; color: #a1a1aa; }
        .c-dropdown.locked:hover .c-dropdown-menu { display: none; }

        /* Dev / Inspect Overlay */
        .dev-overlay { 
            pointer-events: none; position: fixed; inset: 0; z-index: 9999; display: none; 
        }
        body.dev-mode-active .dev-overlay,
        body.dev-mode-full .dev-overlay { 
            display: block; 
        }
        
        .dev-highlight { 
            position: absolute; 
            border: 1px solid #3b82f6; 
            background: rgba(255, 255, 255, 0.1);
            transition: all 0.05s ease-out; 
            pointer-events: none;
        }
        
        .dev-tooltip { 
            position: absolute; 
            background: rgba(255, 255, 255, 0.9);
            color: #000000; 
            padding: 4px 8px; 
            font-size: 12px;   /* Inspector / Dev 폰트 12px */
            border-radius: 2px; 
            font-family: monospace; 
            white-space: pre-wrap; 
            z-index: 10000; 
            box-shadow: 0 2px 8px rgba(0,0,0,0.5); 
            pointer-events: auto;
            max-width: 280px;
        }

        .dev-tooltip-header {
            font-weight: bold;
            margin-bottom: 2px;
        }

        .dev-tooltip-meta {
            color: #333;
        }

        .dev-tooltip-hint {
            margin-top: 2px;
            color: #555;
        }

        .dev-tooltip-devinfo {
            margin-top: 4px;
            padding-top: 4px;
            border-top: 1px solid #999;
            background: rgba(255, 255, 255, 0.9);
            color: #111;
            white-space: pre-wrap;
        }

        /* 컨텍스트 메뉴 */
        .context-menu { 
            position: fixed; background: #1e1e1e; border: 1px solid #333; 
            box-shadow: 0 4px 12px rgba(0,0,0,0.5); z-index: 5000; border-radius: 4px; 
            padding: 4px 0; min-width: 120px; 
        }
        .ctx-item { padding: 4px 12px; font-size: 11px; color: #eee; cursor: pointer; display: flex; justify-content: space-between; gap: 10px; }
        .ctx-item:hover { background: #3b82f6; color: white; }
        
        /* 색상 선택 그리드 */
        .color-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 2px; padding: 4px; }
        .color-swatch { width: 16px; height: 16px; border-radius: 2px; cursor: pointer; border: 1px solid #333; }
        .color-swatch:hover { border-color: white; transform: scale(1.1); }

        .timeline-drag-over { box-shadow: inset 0 0 0 2px #3b82f6; background-color: rgba(59, 130, 246, 0.1); }

        /* 플레이헤드 */
        .playhead-line { position: absolute; top: 0; bottom: 0; width: 1px; background: #ef4444; z-index: 40; pointer-events: none; }
        .playhead-handle { position: absolute; top: 0; width: 11px; height: 12px; background: #ef4444; transform: translateX(-50%); clip-path: polygon(0 0, 100% 0, 50% 100%); cursor: ew-resize; pointer-events: auto; z-index: 50; }
        
        /* Modal */
        .modal-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background-color: rgba(0, 0, 0, 0.7); display: flex; justify-content: center; align-items: center; z-index: 5000; }
        .modal-window { background: #18181b; border: 1px solid #27272a; border-radius: 8px; width: 80%; height: 80%; max-width: 1000px; max-height: 700px; display: flex; flex-direction: column; overflow: hidden; }

        .animate-fade-in { animation: fadeIn 0.2s ease-in-out; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
    </style>
</head>
<body id="app-root-container" class="flex flex-col text-xs">

    <div id="app-vue-root" class="flex flex-col h-screen">
        
        <!-- 헤더 -->
        <!-- ... (헤더/좌/우 패널 부분은 이전 버전과 동일, 생략 없음; 실제 적용 시 전체 붙여넣기) ... -->

        <!-- 메인 레이아웃 -->
        <main id="main-layout-root" class="flex-1 flex overflow-hidden relative">
            <!-- 좌측 패널 ... 생략 ... -->

            <!-- 중앙 패널 -->
            <section id="main-center-panel" class="flex-1 flex flex-col bg-bg-dark min-w-[400px] relative overflow-hidden">
                
                <!-- 프리뷰 컨테이너 -->
                <div
                    id="preview-main-container"
                    class="relative flex flex-col"
                    :style="{ height: previewContainerHeight }"
                >
                    <!-- 프리뷰 툴바 -->
                    <div id="preview-toolbar-panel" class="h-8 bg-bg-panel border-b border-ui-border flex items-center justify-center px-2 gap-3 shrink-0 z-20">
                        <div class="flex items-center gap-2 bg-bg-input rounded px-3 h-6 border border-ui-border">
                            
                            <dropdown-menu
                                id="preview-toolbar-ratio-dropdown"
                                :current-value="aspectRatio"
                                :items="['16:9', '9:16', '1:1']"
                                @select="setAspect"
                                title="캔버스 비율 선택"
                            ></dropdown-menu>

                            <div class="w-px h-3 bg-ui-border"></div>
                            
                            <div
                                id="preview-toolbar-coord-box"
                                class="c-info-box px-2 flex items-center bg-bg-input rounded h-6 border border-ui-border w-24 justify-center"
                                title="마우스 좌표"
                            >
                                <span id="preview-toolbar-coord-label" class="text-xxs font-mono text-ui-accent">
                                    {{ Math.round(mouseCoord.x) }}, {{ Math.round(mouseCoord.y) }}
                                </span>
                            </div>

                            <div class="w-px h-3 bg-ui-border"></div>

                            <dropdown-menu
                                id="preview-toolbar-resolution-dropdown"
                                :current-value="resolution"
                                :items="['8K', '6K', '4K', '3K', '2K']"
                                @select="setResolution"
                                title="캔버스 해상도 선택"
                            ></dropdown-menu>
                            
                            <div class="w-px h-3 bg-ui-border"></div>

                            <div
                                id="preview-toolbar-snap-toggle"
                                class="cursor-pointer flex items-center gap-1 hover:text-white text-[10px] font-bold"
                                @click="isMagnet = !isMagnet"
                                :class="{'text-ui-accent': isMagnet, 'text-text-sub': !isMagnet}"
                                data-action="js:toggleSnapMagnet"
                                title="프리뷰 캔버스 스냅 온/오프"
                            >
                                <i class="fa-solid fa-magnet mr-1"></i> SNAP {{ isMagnet ? 'ON' : 'OFF' }}
                            </div>
                        </div>
                    </div>

                    <!-- 프리뷰 캔버스 -->
                    <div
                        id="preview-canvas-wrapper"
                        class="flex-1 relative overflow-hidden bg-black flex items-center justify-center"
                        @mousemove="updateCanvasMouseCoord"
                        @mouseleave="mouseCoord = {x: 0, y: 0}; isMouseOverCanvas = false"
                    >
                        <!-- 마우스 가이드 -->
                        <div class="absolute top-0 left-0 w-full h-full z-30 pointer-events-none" :style="{paddingLeft: '20px', paddingTop: '20px'}">
                            <div class="absolute w-px h-full bg-ui-accent opacity-30" :style="{left: mouseMarkerPos.x + 'px'}" v-show="isMouseOverCanvas"></div>
                            <div class="absolute h-px w-full bg-ui-accent opacity-30" :style="{top: mouseMarkerPos.y + 'px'}" v-show="isMouseOverCanvas"></div>
                        </div>

                        <!-- 실제 프리뷰 화면 (비율/해상도 반영) -->
                        <div class="relative overflow-hidden" id="preview-canvas-viewport" style="width:100%; height:100%;">
                            <div id="preview-canvas-scaler" class="canvas-scaler" :style="canvasScalerStyle">
                                <div id="preview-guide-h" class="guide-line-h" style="top: 50%;"></div>
                                <div id="preview-guide-v" class="guide-line-v" style="left: 50%;"></div>
                                
                                <preview-canvas
                                    :canvas-boxes="canvasBoxes"
                                    :selected-box-id="selectedBoxId"
                                    @select-box="setSelectedBoxId"
                                    @remove-box="removeBox"
                                ></preview-canvas>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- 타임라인 리사이저 + 타임라인 패널 ... (이하 생략 없이 전체 유지) -->
            </section>

            <!-- 우측 패널 ... -->
        </main>

        <!-- Dev Overlay, 모듈 스크립트 부분은 이전 버전과 동일 -->
    </div>

    <script src="js/utils/constants.js"></script>
    <script src="docs/element-specs.js"></script>

    <script src="js/components/DropdownMenu.js"></script>
    <script src="js/components/RulerLine.js"></script>
    <script src="js/components/ProjectModal.js"></script>
    <script src="js/components/LayerPanel.js"></script>
    <script src="js/components/PropertiesPanel.js"></script>
    <script src="js/components/PreviewCanvas.js"></script>
    <script src="js/components/TimelinePanel.js"></script>

    <script src="js/core/app-root.js"></script>
    <script src="js/core/bootstrap.js"></script>
</body>
</html>
